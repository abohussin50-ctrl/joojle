<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>نتائج البحث - joojle</title>
  <style>
    :root {
      --google-blue: #1a0dab;
      --google-grey: #70757a;
      --google-border: #dfe1e5;
      --active-blue: #1a73e8;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #fff;
      direction: rtl;
    }

    /* الهيدر العلوي */
    header {
      padding-top: 15px;
      border-bottom: 1px solid #ebebeb;
      background: white;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .top-bar {
      display: flex;
      align-items: center;
      padding: 0 3% 15px;
      gap: 20px;
    }

    .logo { 
      font-size: 24px; font-weight: bold; text-decoration: none;
      font-family: 'Product Sans', Arial, sans-serif;
      flex-shrink: 0;
    }
    .blue{color:#4285F4} .red{color:#EA4335} .yellow{color:#FBBC05} .green{color:#34A853}

    /* محرك البحث الطويل والممركز */
    .search-box {
      flex: 1; /* يأخذ المساحة المتبقية ليتوسط الهيدر */
      display: flex;
      justify-content: center;
    }

    .search-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #fff;
      border: 1px solid var(--google-border);
      border-radius: 999px;
      padding: 5px 15px;
      box-shadow: 0 1px 6px rgba(32,33,36,.15);
      width: 100%;
      max-width: 720px; /* جعل المحرك طويلاً */
      box-sizing: border-box;
    }

    .search-wrapper input {
      flex: 1;
      border: none;
      outline: none;
      font-size: 16px;
      padding: 8px;
      direction: rtl;
      background: transparent;
      min-width: 0;
    }

    .icon-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .icon-btn svg {
      width: 22px;
      height: 22px;
      stroke: #5f6368;
      fill: none;
      stroke-width: 2;
    }

    .icon-btn:hover svg {
      stroke: var(--active-blue);
    }

    /* شريط التصنيفات */
    .tabs-container {
      display: flex;
      padding: 0 12%; 
      gap: 20px;
    }

    .tab {
      padding: 10px 5px 12px;
      font-size: 14px;
      color: var(--google-grey);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      border-bottom: 3px solid transparent;
      transition: 0.2s;
    }

    .tab:hover { color: var(--active-blue); }

    .tab.active {
      color: var(--active-blue);
      border-bottom: 3px solid var(--active-blue);
    }

    .tab svg { width: 16px; height: 16px; fill: currentColor; }

    /* منطقة النتائج */
    #results {
      max-width: 650px;
      margin-right: 12%;
      margin-top: 20px;
      padding: 0 15px;
    }

    .result { margin-bottom: 28px; }
    .result-url { font-size: 12px; color: #202124; margin-bottom: 2px; direction: ltr; text-align: right; }
    .result a.title { font-size: 20px; color: var(--google-blue); text-decoration: none; display: block; margin-bottom: 3px; }
    .result a.title:hover { text-decoration: underline; }
    .result .snippet { font-size: 14px; color: #4d5156; line-height: 1.58; }

    /* تنسيق الفيديوهات الجديد */
    .video-item {
      display: flex;
      gap: 15px;
      margin-top: 8px;
    }
    .video-thumb {
      position: relative;
      width: 140px;
      height: 80px;
      flex-shrink: 0;
      border-radius: 8px;
      overflow: hidden;
      background: #eee;
    }
    .video-thumb img { width: 100%; height: 100%; object-fit: cover; }
    .play-overlay {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.6); border-radius: 50%; width: 30px; height: 30px;
      display: flex; align-items: center; justify-content: center;
    }

    /* تنسيق الصور */
    .image-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
    }
    .img-card img { width: 100%; border-radius: 8px; object-fit: cover; height: 120px; }

    @media (max-width: 800px) {
      .top-bar { flex-direction: column; padding: 10px; gap: 10px; }
      .search-box { width: 100%; }
      .tabs-container { padding: 0 15px; justify-content: center; }
      #results { margin-right: 0; margin: auto; }
      .video-item { flex-direction: column; }
    }
  </style>
</head>
<body>

  <header>
    <div class="top-bar">
      <a href="index.html" class="logo">
        <span class="blue">j</span><span class="red">o</span><span class="yellow">o</span><span class="blue">j</span><span class="green">l</span><span class="red">e</span>
      </a>

      <div class="search-box">
        <div class="search-wrapper">
          <button class="icon-btn" onclick="performSearch()" title="بحث">
            <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="7"></circle><line x1="16.65" y1="16.65" x2="22" y2="22"></line></svg>
          </button>

          <input id="searchInput" type="text" placeholder="ابحث في الويب..." onkeydown="if(event.key==='Enter')performSearch()"/>

          <button class="icon-btn" onclick="voiceSearch()" title="بحث صوتي">
            <svg viewBox="0 0 24 24"><path d="M12 14a3 3 0 0 0 3-3V5a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3z"/><path d="M19 11a7 7 0 0 1-14 0"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/></svg>
          </button>

          <button class="icon-btn" onclick="imageSearch()" title="بحث بالصورة">
            <svg viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="14" rx="2"/><circle cx="9" cy="10" r="2"/><path d="M21 15l-5-5L5 21"/></svg>
          </button>
          <input type="file" id="imageInput" accept="image/*" hidden />
        </div>
      </div>
    </div>

    <div class="tabs-container">
      <div class="tab active" id="tab-all" onclick="changeTab('all')">
        <svg viewBox="0 0 24 24"><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg>الكل
      </div>
      <div class="tab" id="tab-image" onclick="changeTab('image')">
        <svg viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>صور
      </div>
      <div class="tab" id="tab-video" onclick="changeTab('video')">
        <svg viewBox="0 0 24 24"><path d="M10 16.5l6-4.5-6-4.5v9zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/></svg>فيديوهات
      </div>
      <div class="tab" id="tab-news" onclick="changeTab('news')">
        <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>أخبار
      </div>
    </div>
  </header>

  <div id="results"></div>

  <script>
    const API_BASE = "https://joojle-one.vercel.app/api/search?q=";
    let currentType = 'all';

    function changeTab(type) {
      currentType = type;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.getElementById(`tab-${type}`).classList.add('active');
      performSearch();
    }

    async function performSearch() {
      const q = document.getElementById("searchInput").value.trim();
      if (!q) return;

      const container = document.getElementById("results");
      container.innerHTML = '<p style="color:#70757a">جاري البحث...</p>';

      try {
        const res = await fetch(`${API_BASE}${encodeURIComponent(q)}&type=${currentType}`);
        const data = await res.json();
        
        container.innerHTML = '';
        const items = Array.isArray(data) ? data : (data.items || []);

        if (items.length === 0) {
          container.innerHTML = '<p>لا توجد نتائج لهذه الفئة.</p>';
          return;
        }

        if (currentType === 'image') {
          const grid = document.createElement('div');
          grid.className = 'image-grid';
          items.forEach(item => {
            grid.innerHTML += `
              <div class="img-card">
                <a href="${item.link}" target="_blank">
                  <img src="${item.image || item.link}" onerror="this.src='https://via.placeholder.com/150'">
                  <div style="font-size:11px; margin-top:5px; color:#70757a">${item.title.substring(0,25)}</div>
                </a>
              </div>`;
          });
          container.appendChild(grid);
        } else if (currentType === 'video') {
          items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'result';
            div.innerHTML = `
              <div class="result-url">${item.link}</div>
              <a class="title" href="${item.link}" target="_blank">${item.title}</a>
              <div class="video-item">
                <div class="video-thumb">
                   <img src="${item.image || 'https://via.placeholder.com/140x80?text=Video'}">
                   <div class="play-overlay"><svg width="16" height="16" fill="white" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>
                </div>
                <div class="snippet">${item.snippet || ''}</div>
              </div>
            `;
            container.appendChild(div);
          });
        } else {
          items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'result';
            div.innerHTML = `
              <div class="result-url">${item.link.substring(0, 70)}...</div>
              <a class="title" href="${item.link}" target="_blank">${item.title}</a>
              <div class="snippet">${item.snippet || ''}</div>
            `;
            container.appendChild(div);
          });
        }
      } catch (err) {
        container.innerHTML = '<p>حدث خطأ أثناء تحميل النتائج.</p>';
      }
    }

    function imageSearch() { document.getElementById("imageInput").click(); }
    
    document.getElementById("imageInput").onchange = function() {
      const file = this.files[0];
      if(file) alert("تم اختيار الصورة: " + file.name + "\nجاري البحث البصري...");
    };

    function voiceSearch() {
      if (!('webkitSpeechRecognition' in window)) return alert("المتصفح لا يدعم البحث الصوتي");
      const rec = new webkitSpeechRecognition();
      rec.lang = "ar-SA";
      rec.onresult = (e) => {
        document.getElementById("searchInput").value = e.results[0][0].transcript;
        performSearch();
      };
      rec.start();
    }

    window.onload = () => {
      const q = new URLSearchParams(window.location.search).get('q');
      if (q) {
        document.getElementById("searchInput").value = q;
        performSearch();
      }
    };
  </script>
</body>
</html>
