<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>joojle</title>
  <meta name="description" content="joojle هو محرك بحث ذكي وسريع شبيه بجوجل، يمكنك من خلاله البحث في الويب بسهولة ودقة.">
  <meta name="keywords" content="joojle, joojle search, google alternative, محرك بحث, بحث, بحث عربي, بحث سريع, محرك بحث عربي, بديل جوجل, بحث الويب, بحث ذكي, محرك بحث يشبه Google, جوجل, بحث متقدم">
  <link rel="icon" href="favicon.png" type="image/png">
  <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
  <style>
    body { background:#fff; font-family:Arial, sans-serif; margin:0; padding:0; direction:rtl; text-align:center; transition: background 0.3s, color 0.3s; }
    
    /* --- التنسيقات العامة للهيدر --- */
    header { position: relative; z-index: 1000; }
    header a { text-decoration: none; color: #202124; font-size: 14px; transition: color 0.2s; }

    /* --- نسخة الكمبيوتر --- */
    .desktop-header { display: flex; justify-content: flex-end; align-items: center; padding: 12px 20px; gap: 15px; }
    .d-links { display: flex; gap: 15px; }
    .d-actions { display: flex; align-items: center; gap: 15px; }

    /* --- نسخة الهاتف --- */
    .mobile-header { display: none; }
    @media (max-width: 767px) {
      .desktop-header { display: none !important; }
      .mobile-header { display: flex !important; justify-content: space-between; align-items: center; padding: 10px 15px; border-bottom: 1px solid #eee; }
      .mobile-right { display: flex; gap: 15px; }
      .mobile-left { display: flex; align-items: center; gap: 10px; }
      
      .m-tab { text-decoration: none; color: #5f6368; padding-bottom: 5px; border-bottom: 3px solid transparent; font-size: 14px; }
      .active-tab { color: #4285f4 !important; font-weight: bold; border-bottom: 3px solid #4285f4 !important; }
    }

    /* --- قائمة التطبيقات --- */
    .apps-container { position: relative; }
    .apps-icon { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; cursor: pointer; }
    .apps-icon:hover { background: rgba(60,64,67,0.1); }
    .apps-icon svg { fill: #5f6368; width: 24px; height: 24px; }
    .apps-dropdown { display: none; position: absolute; top: 55px; left: 0; width: 300px; background: #f8fafd; border-radius: 28px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 20px; z-index: 2001; grid-template-columns: repeat(3, 1fr); gap: 15px; }
    @media (max-width: 767px) { .apps-dropdown { width: 90vw; left: 5vw; position: fixed; top: 60px; } }
    
    .app-item { display: flex; flex-direction: column; align-items: center; text-decoration: none; padding: 10px; border-radius: 16px; transition: background 0.2s; }
    .app-item:hover { background: #eef2fa; }
    .app-item img { width: 35px; height: 35px; margin-bottom: 8px; }
    .app-item span { color: #1f1f1f; font-size: 11px; font-weight: 500; }
    .profile-img { width: 32px; height: 32px; border-radius: 50%; background: #e1e1e1; object-fit: cover; }
.search-box { margin:31px auto; width:600px; max-width:100%; }
.search-wrapper {
  display: flex;
  align-items: center;
  gap: 8px; 
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 999px;
  padding: 8px 12px;
  box-shadow: 0 1px 6px rgba(32,33,36,.28);
  max-width: 600px;
  margin: auto;
  box-sizing: border-box;
  width: 100%;
}

.search-wrapper input {
  flex: 1;
  border: none;
  outline: none;
  font-size: 16px;
  padding: 8px;
  direction: rtl;
  background: transparent;
  min-width: 0;
}

.icon-btn {
  background: none;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  padding: 4px;
  transition: transform 0.1s;
}


.icon-btn svg {
  width: 24px;
  height: 24px;
}
@media (max-width: 480px) {
  .search-wrapper {
    padding: 6px 10px;
    gap: 4px;
  }

  .search-wrapper input {
    font-size: 15px;
    padding: 6px;
  }

  .icon-btn {
    padding: 4px;
  }

  .icon-btn svg {
    width: 18px;
    height: 18px;
  }
}

    /* --- بقية العناصر --- */
    .shortcuts { margin-top:30px; display:flex; justify-content:center; gap:40px; flex-wrap:wrap; }
    .shortcut { text-align:center; color:#333; font-size:14px; cursor:pointer; position:relative; }
    .shortcut-circle { width:60px; height:60px; background-color:#ffe8dc; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 8px; font-size:24px; }
    .delete-btn { position:absolute; top:-8px; right:-8px; background:red; color:white; border:none; border-radius:50%; width:20px; height:20px; font-size:12px; display:none; }
    .shortcut:hover .delete-btn { display:block; }
    
.customize {
  position: fixed;
  bottom: 15px;
  left: 15px;
  background: #ffe8dc !important;
  color: #000000 !important;
  border: 1px solid #dfe1e5;
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 13px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.1);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  z-index: 999;
}

.modal {
  display: none;
  position: fixed;
  z-index: 1001;
  left: 0; top: 0; width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.6);
}

.modal-content {
  background-color: #ffffff !important;
  color: #202124 !important;
  margin: 5% auto;
  padding: 25px;
  border-radius: 12px;
  width: 90%;
  max-width: 350px;
  text-align: right;
  box-shadow: 0 5px 20px rgba(0,0,0,0.3);
}

.modal-content h3, .modal-content label, .modal-content span {
  color: #202124 !important;
  display: block;
  margin-bottom: 5px;
}

.customize-option { margin-bottom: 15px; }

.input-style {
  width: 100%;
  padding: 8px;
  border: 1px solid #dfe1e5;
  border-radius: 4px;
  box-sizing: border-box;
}

.close-modal {
  background: #1a73e8;
  color: white;
  border: none;
  padding: 10px;
  border-radius: 4px;
  cursor: pointer;
  width: 100%;
  margin-top: 10px;
}
/* تنسيق التبويبات في نسخة الكمبيوتر */
.d-links a {
    padding-bottom: 5px;
    border-bottom: 2px solid transparent;
    transition: all 0.3s;
}

/* الحالة النشطة (الخط الأزرق) */
.active-link {
    color: #4285f4 !important;
    border-bottom: 2px solid #4285f4 !important;
}

.logo {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 30px;
}

.main-logo-img {
  width: 220px; /* الحجم القياسي لشعار جوجل */
  height: auto;
  object-fit: contain;
  user-select: none;
  margin-top: 160px;
}
@media (max-width: 480px) {
  .main-logo-img {
    width: 180px; /* تصغير الشعار في الهاتف */
  }
}
  </style>
</head>
<body>

<header class="desktop-header">
  <div class="d-links">
    <a href="https://mail.google.com" target="_blank">Gmail</a>
    <a href="javascript:void(0)" id="d-tab-images" class="d-tab" onclick="setSearchMode('images')">صور</a>
  </div>
  
  <div class="d-actions">
    <div class="apps-container">
      <div class="apps-icon" onclick="toggleApps(event)">
        <svg viewBox="0 0 24 24"><path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM6 4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg>
      </div>
      <div class="apps-dropdown">
        <a href="https://www.google.com" class="app-item"><img src="https://upload.wikimedia.org/wikipedia/commons/2/2d/Google-favicon-2015.png"><span>بحث</span></a>
        <a href="https://maps.google.com" class="app-item"><img src="https://upload.wikimedia.org/wikipedia/commons/a/aa/Google_Maps_icon_%282020%29.svg"><span>خرائط</span></a>
        <a href="https://mail.google.com" class="app-item"><img src="https://upload.wikimedia.org/wikipedia/commons/7/7e/Gmail_icon_%282020%29.svg"><span>Gmail</span></a>
        <a href="https://www.youtube.com" class="app-item"><img src="https://upload.wikimedia.org/wikipedia/commons/e/ef/Youtube_logo.png"><span>YouTube</span></a>
        <a href="https://drive.google.com" class="app-item"><img src="https://upload.wikimedia.org/wikipedia/commons/1/12/Google_Drive_icon_%282020%29.svg"><span>Drive</span></a>
        <a href="https://gemini.google.com" class="app-item"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Google_Gemini_logo.svg/1024px-Google_Gemini_logo.svg.png"><span>Gemini</span></a>
        <a href="https://photos.google.com" class="app-item"><img src="https://storage.googleapis.com/gweb-uniblog-publish-prod/images/Icon_White_BG.width-500.format-webp.webp"><span>صور</span></a>
        <a href="https://translate.google.com" class="app-item"><img src="https://upload.wikimedia.org/wikipedia/commons/d/d7/Google_Translate_logo.svg"><span>ترجمة</span></a>
        <a href="https://calendar.google.com" class="app-item"><img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Google_Calendar_icon_%282020%29.svg"><span>التقويم</span></a>
      </div>
    </div>
    <img src="https://lh3.googleusercontent.com/a/default-user=s64-c" class="profile-img" alt="Profile">
  </div>
</header>

<header class="mobile-header">
  <div class="mobile-right">
    <a href="javascript:void(0)" id="tab-all" class="m-tab active-tab" onclick="setSearchMode('all')">الكل</a>
    <a href="javascript:void(0)" id="tab-images" class="m-tab" onclick="setSearchMode('images')">صور</a>
  </div>
  <div class="mobile-left">
    <div class="apps-container">
      <div class="apps-icon" onclick="toggleApps(event)">
        <svg viewBox="0 0 24 24"><path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM6 4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg>
      </div>
      <div class="apps-dropdown">
        <a href="https://www.google.com" class="app-item"><img src="https://upload.wikimedia.org/wikipedia/commons/2/2d/Google-favicon-2015.png"><span>بحث</span></a>
        <a href="https://maps.google.com" class="app-item"><img src="https://upload.wikimedia.org/wikipedia/commons/a/aa/Google_Maps_icon_%282020%29.svg"><span>خرائط</span></a>
        <a href="https://mail.google.com" class="app-item"><img src="https://upload.wikimedia.org/wikipedia/commons/7/7e/Gmail_icon_%282020%29.svg"><span>Gmail</span></a>
        <a href="https://www.youtube.com" class="app-item"><img src="https://upload.wikimedia.org/wikipedia/commons/e/ef/Youtube_logo.png"><span>YouTube</span></a>
        <a href="https://drive.google.com" class="app-item"><img src="https://upload.wikimedia.org/wikipedia/commons/1/12/Google_Drive_icon_%282020%29.svg"><span>Drive</span></a>
        <a href="https://gemini.google.com" class="app-item"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Google_Gemini_logo.svg/1024px-Google_Gemini_logo.svg.png"><span>Gemini</span></a>
        <a href="https://photos.google.com" class="app-item"><img src="https://storage.googleapis.com/gweb-uniblog-publish-prod/images/Icon_White_BG.width-500.format-webp.webp"><span>صور</span></a>
        <a href="https://translate.google.com" class="app-item"><img src="https://upload.wikimedia.org/wikipedia/commons/d/d7/Google_Translate_logo.svg"><span>ترجمة</span></a>
        <a href="https://calendar.google.com" class="app-item"><img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Google_Calendar_icon_%282020%29.svg"><span>التقويم</span></a>
      </div>
    </div>
    <img src="https://lh3.googleusercontent.com/a/default-user=s64-c" class="profile-img" alt="Profile">
  </div>
</header>

<div class="logo">
  <img src="joojle-logo.png" alt="Joojle" class="main-logo-img">
  
  <div id="image-subtext" style="display: none; color: #4285f4; font-size: 24px; margin-top: -10px; font-weight: 500;">صور</div>
</div>
<div class="search-box">
  <div class="search-wrapper">

    <!-- زر البحث -->
    <button class="icon-btn" onclick="goToResults()" title="بحث">
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" color="#9aa0a6" height="18" width="18" xmlns="http://www.w3.org/2000/svg" style="color: rgb(154, 160, 166);"><path d="M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"></path></svg>
    </button>

    <!-- input -->
    <input
      id="searchInput"
      type="text"
      placeholder="ابحث في الويب..."
      onkeydown="if(event.key==='Enter')goToResults()"
    />

      <!-- بحث صوتي -->
      <button class="icon-btn" onclick="voiceSearch()" title="بحث صوتي">
<svg class="goxjub" focusable="false" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" data-iml="1669911182876"><path fill="#4285f4" d="m12 15c1.66 0 3-1.31 3-2.97v-7.02c0-1.66-1.34-3.01-3-3.01s-3 1.34-3 3.01v7.02c0 1.66 1.34 2.97 3 2.97z"></path><path fill="#34a853" d="m11 18.08h2v3.92h-2z"></path><path fill="#fbbc05" d="m7.05 16.87c-1.27-1.33-2.05-2.83-2.05-4.87h2c0 1.45 0.56 2.42 1.47 3.38v0.32l-1.15 1.18z"></path><path fill="#ea4335" d="m12 16.93a4.97 5.25 0 0 1 -3.54 -1.55l-1.41 1.49c1.26 1.34 3.02 2.13 4.95 2.13 3.87 0 6.99-2.92 6.99-7h-1.99c0 2.92-2.24 4.93-5 4.93z"></path></svg>
      </button>

    <!-- بحث بالصورة -->
    <button class="icon-btn" onclick="imageSearch()" title="بحث بالصورة">
<svg version="1.1" id="Standard_product_icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
	 x="0px" y="0px" width="192px" height="192px" viewBox="0 0 192 192" enable-background="new 0 0 192 192" xml:space="preserve">
<rect id="bounding_box_1_" fill="none" width="192" height="192"/>
<g id="art_layer">
	<circle id="Dot" fill="#4285F4" cx="96" cy="104.15" r="28"/>
	<path id="Red" fill="#EA4335" d="M160,72v40.15V136c0,1.69-0.34,3.29-0.82,4.82v0v0c-1.57,4.92-5.43,8.78-10.35,10.35h0v0
		c-1.53,0.49-3.13,0.82-4.82,0.82H66l16,16h50h12c4.42,0,8.63-0.9,12.46-2.51c3.83-1.62,7.28-3.96,10.17-6.86
		c1.45-1.45,2.76-3.03,3.91-4.74c2.3-3.4,3.96-7.28,4.81-11.44c0.43-2.08,0.65-4.24,0.65-6.45v-12V96.15V84l-6-19l-10.82,2.18
		C159.66,68.71,160,70.31,160,72z"/>
	<path id="Blue" fill="#4285F4" d="M32,72c0-1.69,0.34-3.29,0.82-4.82c1.57-4.92,5.43-8.78,10.35-10.35C44.71,56.34,46.31,56,48,56
		h96c1.69,0,3.29,0.34,4.82,0.82c0,0,0,0,0,0L149,45l-17-5l-16-16h-13.44H96h-6.56H76L60,40H48c-17.67,0-32,14.33-32,32v12v20l16,16
		V72z"/>
	<path id="Green" fill="#34A853" d="M144,40h-12l16.83,16.83c1.23,0.39,2.39,0.93,3.47,1.59c2.16,1.32,3.97,3.13,5.29,5.29
		c0.66,1.08,1.2,2.24,1.59,3.47v0L176,84V72C176,54.33,161.67,40,144,40z"/>
	<path id="Yellow" fill="#FBBC04" d="M48,168h39.89l-16-16H48c-8.82,0-16-7.18-16-16v-23.89l-16-16V136C16,153.67,30.33,168,48,168z
		"/>
</g>
</svg>
    </button>

    <input type="file" id="imageInput" accept="image/*" hidden />

  </div>
</div>

<div id="results"></div>

<div class="shortcuts" id="shortcuts">
  <div class="shortcut" onclick="addShortcut()"><div class="shortcut-circle">+</div><div>إضافة اختصار</div></div>
  <div class="shortcut" onclick="copyLink()"><div class="shortcut-circle">S</div><div>مشاركة</div></div>
  <div class="shortcut" onclick="window.open('https://chrome.google.com/webstore', '_blank')">
    <div class="shortcut-circle"><img src="https://ssl.gstatic.com/gb/images/bar/al-icon.png" alt="icon"></div><div>السوق الإلكتروني</div>
  </div>
</div>

<div class="customize" onclick="openCustomizeModal()">
  <svg width="20" height="20" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" fill="#5f6368"></path></svg>
  تخصيص joojle
</div>

<div id="customizeModal" class="modal">
  <div class="modal-content">
    <h3>تخصيص joojle</h3>
    
<div class="customize-option">
  <label>لون الخلفية:</label>
  <input type="color" id="bgColorPicker" value="#ffffff" onchange="updateTheme()">
</div>

<div class="customize-option">
  <label>لون النصوص:</label>
  <input type="color" id="textColorPicker" value="#000000" onchange="updateTheme()">
</div>
    <div class="customize-option">
      <label>رابط صورة خلفية:</label>
      <input type="text" id="bgImageUrl" class="input-style" placeholder="https://..." onchange="updateTheme()">
    </div>

    <div class="customize-option">
      <label>تحميل صورة من جهازك:</label>
      <input type="file" id="bgImageFile" accept="image/*" class="input-style" onchange="handleFileUpload(this)">
    </div>

    <button class="close-modal" onclick="closeCustomizeModal()">حفظ وإغلاق</button>
    <button onclick="resetTheme()" style="background:none; border:none; color:#ea4335; cursor:pointer; width:100%; margin-top:10px; font-size:12px;">إلغاء المظهر المخصص</button>
  </div>
</div>

<script>
function setSearchMode(mode) {
    const subtext = document.getElementById('image-subtext');
    const dTabImages = document.getElementById('d-tab-images');
    const mTabAll = document.getElementById('tab-all');
    const mTabImages = document.getElementById('tab-images');

    if (mode === 'images') {
        // إظهار كلمة صور تحت اللوجو
        subtext.style.display = 'block';
        
        // تفعيل التنسيق في الكمبيوتر
        if(dTabImages) dTabImages.classList.add('active-link');
        
        // تفعيل التنسيق في الهاتف
        if(mTabImages) mTabImages.classList.add('active-tab');
        if(mTabAll) mTabAll.classList.remove('active-tab');
    } else {
        // إخفاء كلمة صور (وضع الكل)
        subtext.style.display = 'none';
        
        // إلغاء التفعيل في الكمبيوتر
        if(dTabImages) dTabImages.classList.remove('active-link');
        
        // إعادة الهاتف لوضع "الكل"
        if(mTabAll) mTabAll.classList.add('active-tab');
        if(mTabImages) mTabImages.classList.remove('active-tab');
    }
}
// --- متغيرات الحالة ---
let currentSearchMode = 'all';

// --- إدارة الأوضاع (الكل / صور) ---
function setSearchMode(mode) {
    currentSearchMode = mode;
    const tabAll = document.getElementById('tab-all');
    const tabImg = document.getElementById('tab-images');
    const subtext = document.getElementById('image-subtext');

    if (mode === 'images') {
        tabImg.classList.add('active-tab');
        tabAll.classList.remove('active-tab');
        subtext.style.display = 'block';
    } else {
        tabAll.classList.add('active-tab');
        tabImg.classList.remove('active-tab');
        subtext.style.display = 'none';
    }
}

// --- وظيفة البحث الرئيسية ---
function goToResults(query = null) {
    const q = query || document.getElementById("searchInput").value.trim();
    if (!q) return;

    if (currentSearchMode === 'images') {
        // إذا كان المود "صور" يذهب لصفحة الصور ويمرر النوع "image"
        window.location.href = `images.html?q=${encodeURIComponent(q)}&type=image`;
    } else {
        // إذا كان المود "الكل" يذهب لصفحة النتائج العامة ويمرر النوع "all"
        window.location.href = `results.html?q=${encodeURIComponent(q)}&type=all`;
    }
}
// --- إدارة التطبيقات ---
function toggleApps(event) {
    event.stopPropagation();
    const container = event.currentTarget.closest('.apps-container');
    const menu = container.querySelector('.apps-dropdown');
    const isVisible = menu.style.display === 'grid';
    document.querySelectorAll('.apps-dropdown').forEach(m => m.style.display = 'none');
    menu.style.display = isVisible ? 'none' : 'grid';
}

window.onclick = function(event) {
    if (!event.target.closest('.apps-container')) {
        document.querySelectorAll('.apps-dropdown').forEach(m => m.style.display = 'none');
    }
};

// --- البحث الصوتي ---
function voiceSearch() {
    if (!("webkitSpeechRecognition" in window)) {
        alert("المتصفح لا يدعم البحث الصوتي");
        return;
    }
    const recognition = new webkitSpeechRecognition();
    recognition.lang = "ar-SA";
    recognition.start();

    recognition.onresult = function (event) {
        const text = event.results[0][0].transcript;
        document.getElementById("searchInput").value = text;
        
        // استخدام الدالة الموحدة لضمان الذهاب للصفحة الصحيحة
        goToResults(text);
    };
}
// --- البحث بالصور ---
let classifier;
async function loadModel() {
    if (typeof ml5 !== 'undefined') classifier = await ml5.imageClassifier('MobileNet');
}
loadModel();

function imageSearch() { document.getElementById("imageInput").click(); }

document.getElementById("imageInput").addEventListener("change", function (e) {
    const file = e.target.files[0];
    if (!file) return;
    const searchInput = document.getElementById("searchInput");
    searchInput.value = "جاري تحليل الصورة...";
    const reader = new FileReader();
    reader.onload = function (event) {
        const imgElement = new Image();
        imgElement.src = event.target.result;
        imgElement.onload = async () => {
            try {
                if (!classifier) classifier = await ml5.imageClassifier('MobileNet');
                const results = await classifier.classify(imgElement);
                let foundObject = results[0].label.split(',')[0].trim();
                window.location.href = `images.html?q=${encodeURIComponent(foundObject)}`;
            } catch (err) {
                alert("لم نتمكن من تحليل الصورة");
                searchInput.value = "";
            }
        };
    };
    reader.readAsDataURL(file);
});

// --- تخصيص المظهر (Theme) ---
let uploadedImageData = ""; 

function openCustomizeModal() { document.getElementById('customizeModal').style.display = 'block'; }
function closeCustomizeModal() { document.getElementById('customizeModal').style.display = 'none'; }

function handleFileUpload(input) {
    const file = input.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            uploadedImageData = e.target.result;
            document.getElementById('bgImageUrl').value = ""; 
            updateTheme();
        };
        reader.readAsDataURL(file);
    }
}

function updateTheme() {
    const bgColor = document.getElementById('bgColorPicker').value;
    const textColor = document.getElementById('textColorPicker').value;
    const bgUrl = document.getElementById('bgImageUrl').value.trim();
    
    const finalBgImage = uploadedImageData || (bgUrl ? `url('${bgUrl}')` : "");

    document.body.style.backgroundColor = bgColor;
    if (finalBgImage) {
        document.body.style.backgroundImage = finalBgImage.startsWith('data') ? `url('${finalBgImage}')` : finalBgImage;
        document.body.style.backgroundSize = "cover";
        document.body.style.backgroundAttachment = "fixed";
        document.body.style.backgroundPosition = "center";
    } else {
        document.body.style.backgroundImage = "none";
    }

    document.querySelectorAll('header a').forEach(a => {
        a.style.setProperty('color', textColor, 'important');
    });

    document.querySelectorAll('.shortcut div').forEach(div => {
        if (!div.classList.contains('shortcut-circle')) {
            div.style.setProperty('color', textColor, 'important');
        }
    });

    const settings = { bgColor, textColor, bgUrl, uploadedImageData };
    localStorage.setItem('joojleTheme', JSON.stringify(settings));
}

window.addEventListener('DOMContentLoaded', () => {
    const saved = localStorage.getItem('joojleTheme');
    if (saved) {
        const s = JSON.parse(saved);
        document.getElementById('bgColorPicker').value = s.bgColor || "#ffffff";
        document.getElementById('textColorPicker').value = s.textColor || "#202124";
        document.getElementById('bgImageUrl').value = s.bgUrl || "";
        uploadedImageData = s.uploadedImageData || "";
        updateTheme();
    }
});

function resetTheme() {
    if(confirm("هل تريد العودة للمظهر الأصلي؟")) {
        localStorage.removeItem('joojleTheme');
        location.reload();
    }
}

// --- الاختصارات والمشاركة ---
function copyLink(){ navigator.clipboard.writeText(window.location.href).then(()=>alert("تم نسخ الرابط!")); }

function createShortcutElement(name,url){
    const div=document.createElement("div"); div.className="shortcut"; div.onclick=()=>window.open(url,"_blank");
    const circle=document.createElement("div"); circle.className="shortcut-circle"; circle.textContent=name.charAt(0).toUpperCase();
    const label=document.createElement("div"); label.textContent=name;
    const del=document.createElement("button"); del.className="delete-btn"; del.textContent="×";
    del.onclick=(e)=>{ e.stopPropagation(); if(confirm("حذف؟")){ div.remove(); } };
    div.appendChild(circle); div.appendChild(label); div.appendChild(del);
    return div;
}

function addShortcut(){
    const name=prompt("الاسم:"); const url=prompt("الرابط:");
    if(name && url) {
        const container=document.getElementById("shortcuts");
        container.insertBefore(createShortcutElement(name,url), container.firstChild);
    }
}
</script>
</body>
</html>
